"use strict";(self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[]).push([[201],{7201:function(t,e,i){i.r(e),i.d(e,{default:function(){return u}});var s=function(){var t=this,e=t._self._c;return e("div",[e("nav-bar",{attrs:{title:"商品详情",border:!1}}),e("van-swipe",{attrs:{autoplay:3e3},on:{change:t.swiperChange},scopedSlots:t._u([{key:"indicator",fn:function(){return[e("div",{staticClass:"custom-indicator"},[t._v(t._s(t.current+1)+" / "+t._s(t.detail.goods_images&&t.detail.goods_images.length))])]},proxy:!0}])},t._l(t.detail.goods_images,(function(t){return e("van-swipe-item",{key:t.file_id},[e("img",{attrs:{src:t.external_url,alt:""}})])})),1),e("div",{staticClass:"content"},[e("div",{staticClass:"price-sales"},[e("div",{staticClass:"price-box"},[e("span",{staticClass:"price"},[t._v("￥"+t._s(t.detail.goods_price_min))]),"0.00"!==t.detail.line_price_max?e("span",{staticClass:"price2"},[t._v("￥"+t._s(t.detail.line_price_max))]):t._e()]),e("div",{staticClass:"sales"},[t._v("已售"+t._s(t.detail.goods_sales)+"件")])]),e("div",{staticClass:"title"},[t._v(t._s(t.detail.goods_name))]),e("div",{staticClass:"service-wrap"},[e("van-cell",{staticClass:"service-box",attrs:{"is-link":""},on:{click:function(e){t.showService=!0}},scopedSlots:t._u([{key:"title",fn:function(){return t._l(t.goodsService,(function(i){return e("div",{key:i.service_id,staticClass:"text"},[e("van-icon",{attrs:{name:"passed",color:"#c21401"}}),e("span",[t._v(t._s(i.name))])],1)}))},proxy:!0}])}),e("van-action-sheet",{attrs:{title:" ","cancel-text":"我知道了"},model:{value:t.showService,callback:function(e){t.showService=e},expression:"showService"}},[e("div",{staticClass:"content"},t._l(t.goodsService,(function(i){return e("div",{key:i.service_id,staticClass:"service"},[e("div",{staticClass:"title"},[t._v(t._s(i.name))]),e("div",{staticClass:"text"},[t._v(t._s(i.summary))])])})),0)])],1),t.commentList.length>0?e("div",{staticClass:"comment-box"},[e("van-cell",{attrs:{title:`商品评价(${t.total}条)`,"is-link":"",value:"查看更多",to:`/comment/${t.goodsId}`}}),e("div",{staticClass:"list"},t._l(t.commentList,(function(i){return e("div",{key:i.comment_id,staticClass:"item"},[e("div",{staticClass:"top"},[e("img",{staticClass:"img",attrs:{src:i.user.avatar_url||t.defaultImg,alt:""}}),e("div",{staticClass:"name"},[t._v(t._s(i.user.nick_name))]),e("van-rate",{attrs:{value:i.score%6+1,size:16,color:"#ffd21e","void-icon":"star","void-color":"#eee"}})],1),e("div",{staticClass:"con"},[t._v(t._s(i.content))]),e("div",{staticClass:"bot"},[t._v(t._s(i.create_time))])])})),0)],1):t._e(),e("div",{ref:"descDom",staticClass:"desc",domProps:{innerHTML:t._s(t.detail.content)},on:{click:function(e){return t.imageChagange(e)}}})]),e("van-action-sheet",{staticClass:"pannel-box",attrs:{title:"cart"===t.mode?"加入购物车":"立即购买"},model:{value:t.showPannel,callback:function(e){t.showPannel=e},expression:"showPannel"}},[e("div",{staticClass:"content"},[e("div",{staticClass:"goods"},[e("div",{staticClass:"left"},[e("img",{attrs:{src:t.detail.goods_image,alt:""}})]),e("div",{staticClass:"right"},[e("div",{staticClass:"price"},[e("span",[t._v("￥")]),t._v(t._s(t.detail.goods_price_min))]),e("div",{staticClass:"stock"},[t._v("库存"+t._s(t.detail.stock_total))])])]),e("div",{staticClass:"num-box"},[e("div",{staticClass:"label"},[t._v("数量")]),e("count-box",{attrs:{stock:t.detail.stock_total},model:{value:t.countNum,callback:function(e){t.countNum=e},expression:"countNum"}})],1),e("div",{staticClass:"btn-box"},[t.detail.stock_total>0?e("div",["cart"===t.mode?e("button",{staticClass:"btn btn1",on:{click:t.addCart}},[t._v("加入购物车")]):e("button",{staticClass:"btn btn2",on:{click:t.goPay}},[t._v("立即购买")])]):e("div",{staticClass:"btn btn-none"},[t._v("该商品已抢完")])])])]),e("van-goods-action",[e("van-goods-action-icon",{attrs:{icon:"wap-home-o",text:"首页",to:"/home"}}),e("van-goods-action-icon",{class:{"cart-badge-none":0===t.cartTotal},attrs:{icon:"cart-o",text:"购物车",to:"/cart",badge:t.cartTotal}}),e("van-goods-action-button",{staticClass:"btn1",attrs:{type:"warning",text:"加入购物车"},on:{click:t.addFn}}),e("van-goods-action-button",{staticClass:"btn2",attrs:{type:"danger",text:"立即购买"},on:{click:t.buyFn}})],1)],1)},o=[],a=(i(5739),i(6471)),n=(i(560),i(8478)),c=i(7012),r={methods:{loginConfirm(){return!!this.$store.getters.token||(this.$dialog.confirm({title:"提示",message:"需要先登录才能继续操作哦",confirmButtonText:"去登录",confirmButtonColor:"#c21401",cancelButtonText:"再逛逛"}).then((()=>{this.$router.replace(`/login?backUrl=${this.$route.fullPath}`)})).catch((()=>{})),!1)}}},l={name:"GoodsIndex",components:{CountBox:c.Z},mixins:[r],data(){return{current:0,detail:{},commentList:[],goodsService:[],total:0,showService:!1,defaultImg:n,showPannel:!1,mode:"cart",countNum:1,cartTotal:0,imgs:[],imgIndex:0}},created(){this.getGoodsDetail(),this.getGoodsService(),this.getGoodsComment(),this.getCartTotal()},activated(){this.$route.meta.canKeep||(Object.assign(this.$data,this.$options.data()),this.getGoodsDetail(),this.getGoodsService(),this.getGoodsComment(),this.getCartTotal(),document.body.scrollTop=0,document.documentElement.scrollTop=0)},computed:{goodsId(){return this.$route.params.id}},methods:{swiperChange(t){this.current=t},async getGoodsDetail(){const{data:{detail:t}}=await this.$api.goods.getGoodsDetail(this.goodsId);this.detail=t},async getGoodsService(){const{data:{list:t}}=await this.$api.goods.getGoodsService(this.goodsId);this.goodsService=t},async getGoodsComment(){const{data:{list:t,total:e}}=await this.$api.goods.getGoodsComment(this.goodsId,3);this.commentList=t,this.total=e},addFn(){this.mode="cart",this.showPannel=!0},buyFn(){this.mode="buyNow",this.showPannel=!0},addCart(){this.loginConfirm()&&this.cartAdd()},async cartAdd(){const{data:t,message:e}=await this.$api.cart.addCart(this.detail.goods_id,this.countNum,this.detail.skuList[0].goods_sku_id);this.cartTotal=t.cartTotal,this.$toast.success(e),this.showPannel=!1},async getCartTotal(){const{data:t}=await this.$api.cart.getCartTotal();this.cartTotal=t.cartTotal},async goPay(){this.loginConfirm()&&this.$router.push({path:"/pay",query:{mode:"buyNow",goodsId:this.detail.goods_id,goodsNum:this.countNum,goodsSkuId:this.detail.skuList[0].goods_sku_id}})},imageChagange(t){if("IMG"===t.target.nodeName||"img"===t.target.nodeName){const e=t.target.currentSrc,i=this.$refs.descDom.querySelectorAll("img");this.imgs=[],i.forEach(((t,i)=>{this.imgs.push(t.currentSrc),e===t.currentSrc&&(this.imgIndex=i)})),(0,a.Z)({images:this.imgs,startPosition:this.imgIndex})}}},beforeRouteEnter(t,e,i){"GoodsComment"===e.name?t.meta.canKeep=!0:t.meta.canKeep=!1,i()}},h=l,d=i(3736),m=(0,d.Z)(h,s,o,!1,null,"1d8e1570",null),u=m.exports},6471:function(t,e,i){i.d(e,{Z:function(){return k}});var s=i(9299),o=i(6369),a=i(6786),n=(0,a.d)("image-preview"),c=n[0],r=n[1],l=i(7846),h=i(3969),d=i(5590),m=i(9858),u=i(9054),v=i(4535),g=i(5781),f=i(4639),p=i(4958),C=i(9387);function _(t){return Math.sqrt(Math.pow(t[0].clientX-t[1].clientX,2)+Math.pow(t[0].clientY-t[1].clientY,2))}var w,x={mixins:[h.D],props:{src:String,show:Boolean,active:Number,minZoom:[Number,String],maxZoom:[Number,String],rootWidth:Number,rootHeight:Number},data:function(){return{scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}},computed:{vertical:function(){var t=this.rootWidth,e=this.rootHeight,i=e/t;return this.imageRatio>i},imageStyle:function(){var t=this.scale,e={transitionDuration:this.zooming||this.moving?"0s":".3s"};if(1!==t){var i=this.moveX/t,s=this.moveY/t;e.transform="scale("+t+", "+t+") translate("+i+"px, "+s+"px)"}return e},maxMoveX:function(){if(this.imageRatio){var t=this.vertical?this.rootHeight/this.imageRatio:this.rootWidth;return Math.max(0,(this.scale*t-this.rootWidth)/2)}return 0},maxMoveY:function(){if(this.imageRatio){var t=this.vertical?this.rootHeight:this.rootWidth*this.imageRatio;return Math.max(0,(this.scale*t-this.rootHeight)/2)}return 0}},watch:{active:"resetScale",show:function(t){t||this.resetScale()}},mounted:function(){this.bindTouchEvent(this.$el)},methods:{resetScale:function(){this.setScale(1),this.moveX=0,this.moveY=0},setScale:function(t){t=(0,v.w6)(t,+this.minZoom,+this.maxZoom),t!==this.scale&&(this.scale=t,this.$emit("scale",{scale:this.scale,index:this.active}))},toggleScale:function(){var t=this.scale>1?1:2;this.setScale(t),this.moveX=0,this.moveY=0},onTouchStart:function(t){var e=t.touches,i=this.offsetX,s=void 0===i?0:i;this.touchStart(t),this.touchStartTime=new Date,this.fingerNum=e.length,this.startMoveX=this.moveX,this.startMoveY=this.moveY,this.moving=1===this.fingerNum&&1!==this.scale,this.zooming=2===this.fingerNum&&!s,this.zooming&&(this.startScale=this.scale,this.startDistance=_(t.touches))},onTouchMove:function(t){var e=t.touches;if(this.touchMove(t),(this.moving||this.zooming)&&(0,g.PF)(t,!0),this.moving){var i=this.deltaX+this.startMoveX,s=this.deltaY+this.startMoveY;this.moveX=(0,v.w6)(i,-this.maxMoveX,this.maxMoveX),this.moveY=(0,v.w6)(s,-this.maxMoveY,this.maxMoveY)}if(this.zooming&&2===e.length){var o=_(e),a=this.startScale*o/this.startDistance;this.setScale(a)}},onTouchEnd:function(t){var e=!1;(this.moving||this.zooming)&&(e=!0,this.moving&&this.startMoveX===this.moveX&&this.startMoveY===this.moveY&&(e=!1),t.touches.length||(this.zooming&&(this.moveX=(0,v.w6)(this.moveX,-this.maxMoveX,this.maxMoveX),this.moveY=(0,v.w6)(this.moveY,-this.maxMoveY,this.maxMoveY),this.zooming=!1),this.moving=!1,this.startMoveX=0,this.startMoveY=0,this.startScale=1,this.scale<1&&this.resetScale())),(0,g.PF)(t,e),this.checkTap(),this.resetTouchStatus()},checkTap:function(){var t=this;if(!(this.fingerNum>1)){var e=this.offsetX,i=void 0===e?0:e,s=this.offsetY,o=void 0===s?0:s,a=new Date-this.touchStartTime,n=250,c=5;i<c&&o<c&&a<n&&(this.doubleTapTimer?(clearTimeout(this.doubleTapTimer),this.doubleTapTimer=null,this.toggleScale()):this.doubleTapTimer=setTimeout((function(){t.$emit("close"),t.doubleTapTimer=null}),n))}},onLoad:function(t){var e=t.target,i=e.naturalWidth,s=e.naturalHeight;this.imageRatio=s/i}},render:function(){var t=arguments[0],e={loading:function(){return t(p.Z,{attrs:{type:"spinner"}})}};return t(C.Z,{class:r("swipe-item")},[t(f.Z,{attrs:{src:this.src,fit:"contain"},class:r("image",{vertical:this.vertical}),style:this.imageStyle,scopedSlots:e,on:{load:this.onLoad}})])}},y=c({mixins:[h.D,(0,l.e)({skipToggleEvent:!0}),(0,d.X)((function(t){t(window,"resize",this.resize,!0),t(window,"orientationchange",this.resize,!0)}))],props:{className:null,closeable:Boolean,asyncClose:Boolean,overlayStyle:Object,showIndicators:Boolean,images:{type:Array,default:function(){return[]}},loop:{type:Boolean,default:!0},overlay:{type:Boolean,default:!0},minZoom:{type:[Number,String],default:1/3},maxZoom:{type:[Number,String],default:3},transition:{type:String,default:"van-fade"},showIndex:{type:Boolean,default:!0},swipeDuration:{type:[Number,String],default:300},startPosition:{type:[Number,String],default:0},overlayClass:{type:String,default:r("overlay")},closeIcon:{type:String,default:"clear"},closeOnPopstate:{type:Boolean,default:!0},closeIconPosition:{type:String,default:"top-right"}},data:function(){return{active:0,rootWidth:0,rootHeight:0,doubleClickTimer:null}},mounted:function(){this.resize()},watch:{startPosition:"setActive",value:function(t){var e=this;t?(this.setActive(+this.startPosition),this.$nextTick((function(){e.resize(),e.$refs.swipe.swipeTo(+e.startPosition,{immediate:!0})}))):this.$emit("close",{index:this.active,url:this.images[this.active]})}},methods:{resize:function(){if(this.$el&&this.$el.getBoundingClientRect){var t=this.$el.getBoundingClientRect();this.rootWidth=t.width,this.rootHeight=t.height}},emitClose:function(){this.asyncClose||this.$emit("input",!1)},emitScale:function(t){this.$emit("scale",t)},setActive:function(t){t!==this.active&&(this.active=t,this.$emit("change",t))},genIndex:function(){var t=this.$createElement;if(this.showIndex)return t("div",{class:r("index")},[this.slots("index",{index:this.active})||this.active+1+" / "+this.images.length])},genCover:function(){var t=this.$createElement,e=this.slots("cover");if(e)return t("div",{class:r("cover")},[e])},genImages:function(){var t=this,e=this.$createElement;return e(u.Z,{ref:"swipe",attrs:{lazyRender:!0,loop:this.loop,duration:this.swipeDuration,initialSwipe:this.startPosition,showIndicators:this.showIndicators,indicatorColor:"white"},class:r("swipe"),on:{change:this.setActive}},[this.images.map((function(i){return e(x,{attrs:{src:i,show:t.value,active:t.active,maxZoom:t.maxZoom,minZoom:t.minZoom,rootWidth:t.rootWidth,rootHeight:t.rootHeight},on:{scale:t.emitScale,close:t.emitClose}})}))])},genClose:function(){var t=this.$createElement;if(this.closeable)return t(m.Z,{attrs:{role:"button",name:this.closeIcon},class:r("close-icon",this.closeIconPosition),on:{click:this.emitClose}})},onClosed:function(){this.$emit("closed")},swipeTo:function(t,e){this.$refs.swipe&&this.$refs.swipe.swipeTo(t,e)}},render:function(){var t=arguments[0];return t("transition",{attrs:{name:this.transition},on:{afterLeave:this.onClosed}},[this.shouldRender?t("div",{directives:[{name:"show",value:this.value}],class:[r(),this.className]},[this.genClose(),this.genImages(),this.genIndex(),this.genCover()]):null])}}),b=i(3370),S={loop:!0,value:!0,images:[],maxZoom:3,minZoom:1/3,onClose:null,onChange:null,className:"",showIndex:!0,closeable:!1,closeIcon:"clear",asyncClose:!1,transition:"van-fade",getContainer:"body",overlayStyle:null,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"},$=function(){w=new(o.ZP.extend(y))({el:document.createElement("div")}),document.body.appendChild(w.$el),w.$on("change",(function(t){w.onChange&&w.onChange(t)})),w.$on("scale",(function(t){w.onScale&&w.onScale(t)}))},T=function(t,e){if(void 0===e&&(e=0),!b.sk){w||$();var i=Array.isArray(t)?{images:t,startPosition:e}:t;return(0,s.Z)(w,S,i),w.$once("input",(function(t){w.value=t})),w.$once("closed",(function(){w.images=[]})),i.onClose&&(w.$off("close"),w.$once("close",i.onClose)),w}};T.Component=y,T.install=function(){o.ZP.use(y)};var k=T},5739:function(t,e,i){i(1958),i(6196),i(3332),i(6742),i(7179),i(2666),i(2939),i(9137),i(1088)}}]);
//# sourceMappingURL=201.d1d415d4.js.map