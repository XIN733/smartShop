"use strict";(self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[]).push([[787],{2787:function(t,e,s){s.r(e),s.d(e,{default:function(){return n}});var a=function(){var t=this,e=t._self._c;return e("div",[e("van-nav-bar",{attrs:{title:"add"===t.mode?"添加地址":"编辑地址","left-arrow":"",fixed:"","z-index":"100",placeholder:"",border:!1},on:{"click-left":function(e){return t.$router.replace("/addressList")}}}),e("div",{staticClass:"form-box"},[e("div",{staticClass:"item"},[e("div",{staticClass:"content"},[e("div",{staticClass:"label"},[t._v("姓名")]),e("div",{staticClass:"input-box"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.name,expression:"form.name"}],staticClass:"input",attrs:{type:"text",placeholder:"收货人姓名"},domProps:{value:t.form.name},on:{input:function(e){e.target.composing||t.$set(t.form,"name",e.target.value)}}})])])]),e("div",{staticClass:"item"},[e("div",{staticClass:"content"},[e("div",{staticClass:"label"},[t._v("电话")]),e("div",{staticClass:"input-box"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.phone,expression:"form.phone"}],staticClass:"input",attrs:{type:"text",placeholder:"收货人手机号"},domProps:{value:t.form.phone},on:{input:function(e){e.target.composing||t.$set(t.form,"phone",e.target.value)}}})])])]),e("div",{staticClass:"item region-box",on:{click:t.showPopup}},[e("div",{staticClass:"content"},[e("div",[e("div",{staticClass:"label"},[t._v("地区")]),e("div",{staticClass:"input-box"},[e("div",{class:{text:!0,color:t.form.region.length>0}},[t._v(t._s(t.areaText))])])]),e("van-icon",{staticClass:"icon-arrow",attrs:{name:"arrow"}})],1)]),e("div",{staticClass:"item detail-box"},[e("div",{staticClass:"content"},[e("div",{staticClass:"label"},[t._v("详细地址")]),e("div",{staticClass:"input-box"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.detail,expression:"form.detail"}],staticClass:"textarea",style:{height:t.styleHeight*t.styleNum+"px"},attrs:{placeholder:"街道门牌、楼层房间号等信息"},domProps:{value:t.form.detail},on:{input:[function(e){e.target.composing||t.$set(t.form,"detail",e.target.value)},t.addressDetail]}})])])]),e("div",{staticClass:"item default-box"},[e("div",{staticClass:"content"},[e("div",{staticClass:"label"},[t._v("设为默认收货地址")]),e("van-switch",{attrs:{size:"24","active-color":"orange"},model:{value:t.form.isdefault,callback:function(e){t.$set(t.form,"isdefault",e)},expression:"form.isdefault"}})],1)]),"add"===t.mode?e("button",{staticClass:"btn save",on:{click:t.save}},[t._v("保存")]):e("button",{staticClass:"btn save",on:{click:t.edit}},[t._v("修改")]),"edit"===t.mode?e("button",{staticClass:"btn del",on:{click:t.delAddress}},[t._v("删除")]):t._e()]),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isShowPopup,callback:function(e){t.isShowPopup=e},expression:"isShowPopup"}},[e("van-picker",{attrs:{"show-toolbar":"",columns:t.arealist},on:{confirm:t.onConfirm,cancel:t.onCancel}})],1)],1)},i=[],o={name:"AddAddress",data(){return{form:{name:"",phone:"",detail:"",region:[],isdefault:!1},styleNum:1,styleHeight:20,arealist:[],isShowPopup:!1,addressId:NaN}},created(){this.getRegion(),this.$route.query.addressId&&(this.addressId=Number(this.$route.query.addressId))},computed:{mode(){return this.$route.query.mode},areaText(){const{region:t}=this.form;return 0===t.length?"选择省 / 市 / 区":t[0].label+t[1].label+t[2].label}},watch:{addressId(t,e){this.getAddressDetail(t)}},methods:{showPopup(){this.isShowPopup=!0},onCancel(){this.isShowPopup=!1},onConfirm(t,e){this.form.region=[{value:this.arealist[e[0]].id,label:t[0]},{value:this.arealist[e[0]].children[e[1]].id,label:t[1]},{value:this.arealist[e[0]].children[e[1]].children[e[2]].id,label:t[2]}],this.isShowPopup=!1},addressDetail(t){const e=t.target.value;e.length>0?this.styleNum=Math.ceil(e.length/18):this.styleNum=1},async getRegion(){const{data:{list:t}}=await this.$api.address.getRegion();this.arealist=Object.values(t).map((t=>(t={id:t.id,text:t.name,children:Object.values(t.city).map((t=>(t={id:t.id,text:t.name,children:Object.values(t.region).map((t=>(t={id:t.id,text:t.name},t)))},t)))},t)))},rule(){const t=/^1[3-9]\d{9}$/;return this.form.name?this.form.phone?t.test(this.form.phone)?0===this.form.region.length?(this.$toast("请选择地区"),!1):!!this.form.detail||(this.$toast("请输入详细地址"),!1):(this.$toast("请输入正确的手机号"),!1):(this.$toast("请输入手机号"),!1):(this.$toast("请输入收货人姓名"),!1)},save(){this.rule()&&this.$store.dispatch("address/addAddress",this.form)},edit(){if(this.rule()){const t={addressId:this.addressId,form:this.form};this.$store.dispatch("address/editAddress",t)}},async delAddress(){await this.$api.address.delAddress(this.addressId),this.$toast.success("删除成功");const t=setTimeout((()=>{this.$router.replace("/addressList"),clearTimeout(t)}),1e3)},async getAddressDetail(t){const{data:{detail:e}}=await this.$api.address.getAddressDetail(t);this.form={name:e.name,phone:e.phone,detail:e.detail,region:[{value:e.province_id,label:e.region.province},{value:e.city_id,label:e.region.city},{value:e.region_id,label:e.region.region}],isdefault:this.$store.state.address.defaultId===e.address_id}}}},r=o,d=s(3736),l=(0,d.Z)(r,a,i,!1,null,"a8dd1ba6",null),n=l.exports}}]);
//# sourceMappingURL=787.4eb10884.js.map