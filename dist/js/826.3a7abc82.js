"use strict";(self["webpackChunkvue_project"]=self["webpackChunkvue_project"]||[]).push([[826],{826:function(t,s,e){e.r(s),e.d(s,{default:function(){return m}});var i=function(){var t=this,s=t._self._c;return s("div",[s("nav-bar",{attrs:{title:"我的订单",border:!1}}),s("van-tabs",{model:{value:t.active,callback:function(s){t.active=s},expression:"active"}},[s("van-tab",{attrs:{name:"all",title:"全部"}}),s("van-tab",{attrs:{name:"payment",title:"待支付"}}),s("van-tab",{attrs:{name:"delivery",title:"待发货"}}),s("van-tab",{attrs:{name:"received",title:"待收货"}}),s("van-tab",{attrs:{name:"comment",title:"待评价"}})],1),t.list.length>0?s("div",{ref:"listDom",staticClass:"list-load",on:{scroll:t.pageScroll}},[s("order-list-item",{attrs:{list:t.list},on:{cancelOrder:t.cancelOrder}}),t.finished?s("div",{staticClass:"end"},[t._v("没有更多了")]):t._e()],1):s("div",{staticClass:"empty"},[s("van-empty",{attrs:{description:"暂无内容"}})],1),s("img",{class:{goTop:!0,"goTop-show":t.isShowGoTop},attrs:{src:t.goTopIcon,alt:""},on:{click:t.goTop}})],1)},a=[],o=(e(560),function(){var t=this,s=t._self._c;return s("div",{staticClass:"list"},t._l(t.list,(function(e){return s("div",{key:e.order_id,staticClass:"item",on:{click:function(s){return t.$router.push(`/order/${e.order_id}`)}}},[s("div",{staticClass:"top"},[s("div",{staticClass:"date"},[t._v(t._s(e.create_time))]),s("div",{staticClass:"state"},[t._v(t._s(e.state_text))])]),s("div",{staticClass:"bot"},[s("div",{staticClass:"goods-box"},t._l(e.goods,(function(e){return s("div",{key:e.goods_id,staticClass:"goods"},[s("div",{staticClass:"left"},[s("img",{attrs:{src:e.goods_image,alt:""}}),s("div",{staticClass:"text line2"},[t._v(t._s(e.goods_name))])]),s("div",{staticClass:"right"},[s("div",{staticClass:"text1"},[t._v("￥"+t._s(e.goods_price))]),s("div",{staticClass:"text2"},[t._v("x "+t._s(e.total_num))])])])})),0),s("div",{staticClass:"total"},[t._v("共 "+t._s(e.total_num)+" 件商品，总金额￥"+t._s(e.pay_price))]),s("div",{staticClass:"btn-box"},["待发货"===e.state_text?s("button",{staticClass:"btn",on:{click:function(s){return s.stopPropagation(),t.cancelOrder(e.order_id)}}},[t._v("申请取消")]):t._e(),"待收货"===e.state_text?s("button",{staticClass:"btn"},[t._v("确认收货")]):t._e(),"待评价"===e.state_text?s("button",{staticClass:"btn"},[t._v("评价")]):t._e(),"待取消"===e.state_text?s("div",{staticClass:"text"},[t._v("取消申请中")]):t._e()])])])})),0)}),r=[],l={props:{list:Array},methods:{cancelOrder(t){this.$dialog.confirm({message:"确定要取消该订单吗？"}).then((()=>{this.$emit("cancelOrder",t)})).catch((()=>{}))}}},n=l,c=e(3736),d=(0,c.Z)(n,o,r,!1,null,"1d043850",null),h=d.exports,p=e(7154),v={name:"OrderIndex",components:{OrderListItem:h},mixins:[p.Z],data(){return{active:this.$route.query.dataType||"all",list:[],page:1,pageSize:15,pageTotal:1,scroll:0}},activated(){this.$route.meta.canKeep?this.$refs.listDom.scrollTop=this.scroll:this.active===this.$route.query.dataType?(this.refresh(),this.getList()):this.active=this.$route.query.dataType},watch:{active(){this.refresh(),this.getList()}},methods:{async getList(){const{data:{list:t}}=await this.$api.order.getOrderList(this.active,this.page),s=t.data.map((t=>(t.total_num=t.goods.reduce(((t,s)=>t+s.total_num),0),t))),e=this.list;this.list=e.concat(s),this.pageTotal=Math.ceil(t.total/this.pageSize),1===this.pageTotal&&(this.finished=!0)},async cancelOrder(t){await this.$api.order.cancelOrder(t),this.refresh(),this.getList().then((()=>{this.$toast.success("订单取消成功")}))}},beforeRouteEnter(t,s,e){"OrderDetail"!==s.name||t.query.update?t.meta.canKeep=!1:t.meta.canKeep=!0,e()},beforeRouteLeave(t,s,e){this.list.length>0&&(this.scroll=this.$refs.listDom.scrollTop||0),e()}},u=v,g=(0,c.Z)(u,i,a,!1,null,"3f66f8cf",null),m=g.exports},7154:function(t,s,e){e.d(s,{Z:function(){return a}});var i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABIBAMAAACnw650AAAAJ1BMVEUAAACGhobFxcX6+vpubm6qqqqZmZng4ODY2Ni4uLguLi5SUlL///8JT6i7AAAADHRSTlNNeqb1b5CFx72bWGN+OwvvAAAAnElEQVRIx+3MsQ2CUBSF4WOChVbGxAG0cAEtKV7iAtpYWTmHI1gwAiOwAyFQ3KE4eaGABO7tSCD3r/988Dxv0E/61RgtHUwlRjte+p0xS8ktwOwhdxtKpQw2JKQsqJE/KQN6yYmUDlUbOXxIqdCT05aUCoETSKlQnEipUJxIFZhoRyhOpDJMtL+im/DNoRUn5tNKp0QC7N7wvIXUAut4SPYhibFYAAAAAElFTkSuQmCC",a={data(){return{finished:!1,goTopIcon:i,isShowGoTop:!1}},methods:{pageScroll(t){const s=t.target.scrollTop,e=t.target.clientHeight,i=t.target.scrollHeight;this.isShowGoTop=s>=2*e,s+e===i&&(this.page<this.pageTotal?(this.page++,this.getList()):this.finished=!0)},refresh(){this.page=1,this.list=[],this.finished=!1,this.isShowGoTop=!1,this.$refs.listDom&&(this.$refs.listDom.scrollTop=0)},goTop(){let t=this.$refs.listDom.scrollTop;if(t>0){const s=50,e=Math.floor(200/(t/s)),i=setInterval((()=>{if(t>0)return t-=s,void(this.$refs.listDom.scrollTop=t);clearInterval(i)}),e)}}}}}}]);
//# sourceMappingURL=826.3a7abc82.js.map